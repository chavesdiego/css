"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};!function(t){var o={};function r(n){if(o[n])return o[n].exports;var e=o[n]={i:n,l:!1,exports:{}};return t[n].call(e.exports,e,e.exports,r),e.l=!0,e.exports}r.m=t,r.c=o,r.d=function(n,e,t){r.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"===(void 0===e?"undefined":_typeof(e))&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)r.d(t,o,function(n){return e[n]}.bind(null,o));return t},r.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(e,"a",e),e},r.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},r.p="",r(r.s=2)}({"./src/assets/js/custom-product-emoji/custom-product-emoji.js":function srcAssetsJsCustomProductEmojiCustomProductEmojiJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _sku_selection__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sku-selection */ \"./src/assets/js/custom-product-emoji/sku-selection/index.js\");\n/* harmony import */ var _sku_attachment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sku-attachment */ \"./src/assets/js/custom-product-emoji/sku-attachment/index.js\");\n\n\n\nconst item = { quantity: 1, seller: 1, id: null }\nconst skuService = { Inicial: null, Simbolo: null }\n\nwindow.addEventListener('skuchange', ({ detail: id }) => { item.id = id })\n\nwindow.addEventListener('initalchange', ({ detail: initial }) => {  \n  skuService.Inicial = initial.toUpperCase() \n\n})\n\nwindow.addEventListener('symbolchange', ({ detail: symbol }) => {  \n  skuService.Simbolo = symbol \n\n})\n\nconst customProduct = () => {\n  const sku = Object(_sku_selection__WEBPACK_IMPORTED_MODULE_0__[\"default\"])()\n  const input = Object(_sku_attachment__WEBPACK_IMPORTED_MODULE_1__[\"default\"])()\n  const addToCartButton = document.getElementById('button_add-to-cart')\n  let currentItemIndex = null;\n\n  const added = () => {\n    swal({ \n      icon: 'success', \n      text: 'Produto adicionado ao carrinho!',\n      buttons: {\n        cart: { text: 'ver carrinho', value: 'cart' },\n        continue: { text: 'escolher mais produtos', value: 'continue' }\n      }\n    })\n    .then(value => {\n      switch (value) {\n        case \"cart\":\n          window.location.assign('http://jchermann.com/checkout')\n          break;\n        case \"continue\":\n          window.location.assign('http://jchermann.com/busca')\n          break;\n        default:\n          return true\n      }\n      \n    })\n  }\n\n  const onAddToCart = async() => {\n    if(!item.id) {\n      swal({ icon: 'info', text: 'Escolha um tamanho'});\n      return;\n    }\n\n    if(skuService.Inicial && !skuService.Simbolo) {\n      swal({ icon: 'info', text: 'Escolha um símbolo'});\n      return;\n    }\n\n    if(skuService.Simbolo && !skuService.Inicial) {\n      swal({ icon: 'info', text: 'Adicione sua inicial'});\n      return;\n    }\n\n    try {\n      document.body.classList.add('loading');\n      const updatedOrderForm = await vtexjs.checkout.addToCart([item], null).then(orderForm => orderForm)\n\n      \n      if(skuService.Inicial && skuService.Simbolo) {\n        const currentItem = updatedOrderForm.items.filter(i => i.id == item.id).slice(-1)[0];\n        // const currentItem = updatedOrderForm.items.slice(-1)[0];\n        // const itemOfering = currentItem.offerings.filter(o => o.type === 'Emoji');\n        const itemOfering = currentItem.offerings.filter(c => c.attachmentOfferings.some(o => o.name === 'Inicial e simbolo'))\n        \n        // currentItemIndex = updatedOrderForm.items.length - 1;\n        currentItemIndex = updatedOrderForm.items.findIndex(i => i.uniqueId == currentItem.uniqueId);\n\n        const offeringId = itemOfering[0].id\n        const attachmentData = {...skuService}\n\n        await vtexjs.checkout.addOffering(offeringId, currentItemIndex) \n\n        const attachment = await vtexjs.checkout\n          .addBundleItemAttachment(currentItemIndex, offeringId, \"Inicial e simbolo\", attachmentData)\n  \n        const currentAddedItemError = attachment.messages.filter(m => m.fields.skuName === currentItem.skuName)\n\n        if(currentAddedItemError.length) {\n          vtexjs.checkout.removeItems([{ index: currentItemIndex, quantity: 0 }], null);\n          swal({ icon: 'error', text: currentAddedItemError[0].text });\n        } else {\n          added()\n        }\n        return\n      }\n\n      added()\n\n    } catch(err) {\n      console.log(err)\n      const text = \"Erro ao personalizar\" \n      vtexjs.checkout.removeItems([{ index: currentItemIndex, quantity: 0 }], null);\n      swal({ \n        icon: 'error', \n        text: `\n          Erro ao customizar o produto. Tente novamente.\n        `\n      });\n    } finally {\n      document.body.classList.remove('loading');\n    }\n  }\n\n  const init = () => {\n    sku.createSkuSelectionComponent()\n    input.init()\n    addToCartButton.addEventListener('click', onAddToCart);\n  }\n  \n  return {\n    init\n  }\n}\n\n\nconst a = customProduct()\n\na.init()\n\n\n//# sourceURL=webpack:///./src/assets/js/custom-product-emoji/custom-product-emoji.js?")},"./src/assets/js/custom-product-emoji/sku-attachment/index.js":function srcAssetsJsCustomProductEmojiSkuAttachmentIndexJs(module,__webpack_exports__,__webpack_require__){eval('__webpack_require__.r(__webpack_exports__);\nconst skuAttachmentInput = () => {\n  const wrapper = document.getElementById(\'sku-service\')\n  const attInput = document.createElement(\'input\')\n  const attSelect = document.createElement(\'select\')\n  const div = document.createElement(\'div\')\n  const symbol = document.createElement(\'form\') \n\n\n  attSelect.innerHTML = `\n    <option value="">Escolha um símbolo</option>\n    <option value="coracao">❤️</option>\n    <option value="arcoiru">🌈</option>\n    <option value="drink">🍸</option>\n  ` \n\n  symbol.className = \'radio-group\';\n  symbol.innerHTML = \'<div>Escolha um símbolo</div>\'\n\n  symbol.innerHTML += `\n  <div class="radio-group-items">\n    <div>\n      <input type="radio" name="symbol" value="Coração" id="coracao">\n      <label for="coracao">❤️</label>\n    </div>\n    <div>\n      <input type="radio" name="symbol" value="Arco-Íris" id="arcuiru">\n      <label for="arcuiru">🌈</label>\n    </div>\n    <div>\n      <input type="radio" name="symbol" value="Taça" id="drink">\n      <label for="drink">🍸</label>\n    </div>\n  </div>\n  `\n\n  \n  div.innerHTML = \'Personalize sua camiseta:\'\n\n  const onInitialChange = ({ target }) => {\n    const initial = new CustomEvent(\'initalchange\', { detail: target.value })\n    window.dispatchEvent(initial)\n  }\n\n  const onSymbolChange = ({ target }) => {\n    const symbol = new CustomEvent(\'symbolchange\', { detail: target.value })\n    window.dispatchEvent(symbol)\n  }\n\n  const init = () => {\n    wrapper.appendChild(div)\n    wrapper.appendChild(attInput)\n    // wrapper.appendChild(attSelect)\n    wrapper.appendChild(symbol)\n\n    attInput.style = \'text-transform: uppercase;\'\n    attInput.setAttribute(\'placeholder\', \'Sua inicial\')\n    attInput.setAttribute(\'maxlength\', \'1\')\n    attInput.addEventListener(\'keyup\', onInitialChange)\n    symbol.addEventListener(\'change\', onSymbolChange)\n    \n  }\n\n  return {\n    init\n  }\n}\n\n/* harmony default export */ __webpack_exports__["default"] = (skuAttachmentInput);\n\n//# sourceURL=webpack:///./src/assets/js/custom-product-emoji/sku-attachment/index.js?')},"./src/assets/js/custom-product-emoji/sku-selection/index.js":function srcAssetsJsCustomProductEmojiSkuSelectionIndexJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\nconst skuSelection = () => {\n  const fetchCurrentProduct = () => vtexjs.catalog.getCurrentProductWithVariations()\n  const skuSelectionWrapper = document.getElementById('sku-selection')\n  \n  const onSkuSelect = ({ target }) => {\n    const onSkuChange = new CustomEvent(\n      'skuchange',\n       { detail: target.dataset.sku } \n    )\n\n    const previousSelected = document.querySelector('.sku-selection-button.selected')\n    previousSelected && previousSelected.classList.remove('selected')\n    target.classList.toggle('selected')\n    \n    window.dispatchEvent(onSkuChange)\n  }\n\n  const skuSelectionButton = ({ sku, skuname, available }) => {\n    const button = document.createElement('button')\n\n    button.className = 'sku-selection-button'\n    button.innerHTML = skuname\n    button.setAttribute('data-sku', sku)\n    button.addEventListener('click', onSkuSelect)\n\n    if(!available){\n      button.setAttribute('disabled', 'disabled')\n    }\n\n    return button\n  }\n\n  const createSkuSelectionComponent = async() => {\n    const fragment = document.createDocumentFragment()\n    const product = await fetchCurrentProduct()\n    \n    product.skus.map(sku => \n      fragment.append(skuSelectionButton(sku))\n    )\n\n    skuSelectionWrapper.appendChild(fragment)\n  }\n\n  return {\n    createSkuSelectionComponent\n  }\n}\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (skuSelection);\n\n//# sourceURL=webpack:///./src/assets/js/custom-product-emoji/sku-selection/index.js?")},2:function _(module,exports,__webpack_require__){eval('module.exports = __webpack_require__(/*! /Users/diegochaves/Projects/vtex-jchermann/src/assets/js/custom-product-emoji/custom-product-emoji.js */"./src/assets/js/custom-product-emoji/custom-product-emoji.js");\n\n\n//# sourceURL=webpack:///multi_./src/assets/js/custom-product-emoji/custom-product-emoji.js?')}});
