"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(e){var r={};function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(t,n,e){o.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(n,t){if(1&t&&(n=o(n)),8&t)return n;if(4&t&&"object"===(void 0===n?"undefined":_typeof(n))&&n&&n.__esModule)return n;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var r in n)o.d(e,r,function(t){return n[t]}.bind(null,r));return e},o.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(n,"a",n),n},o.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},o.p="",o(o.s=1)}({"./src/assets/js/custom-product/custom-product.js":function srcAssetsJsCustomProductCustomProductJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _sku_selection__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./sku-selection */ \"./src/assets/js/custom-product/sku-selection/index.js\");\n/* harmony import */ var _sku_attachment__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sku-attachment */ \"./src/assets/js/custom-product/sku-attachment/index.js\");\n\n\n\nconst item = { quantity: 1, seller: 1, id: null }\nconst skuService = { Inicial: null }\n\nwindow.addEventListener('skuchange', ({ detail: id }) => { item.id = id })\nwindow.addEventListener('initalchange', ({ detail: initials }) => {  skuService.Inicial = initials })\n\nconst customProduct = () => {\n  const sku = Object(_sku_selection__WEBPACK_IMPORTED_MODULE_0__[\"default\"])()\n  const input = Object(_sku_attachment__WEBPACK_IMPORTED_MODULE_1__[\"default\"])()\n  const addToCartButton = document.getElementById('button_add-to-cart')\n  let currentItemIndex = null;\n\n  const added = () => {\n    swal({ \n      icon: 'success', \n      text: 'Produto adicionado ao carrinho!',\n      buttons: {\n        cart: { text: 'ver carrinho', value: 'cart' },\n        continue: { text: 'escolher mais produtos', value: 'continue' }\n      }\n    })\n    .then(value => {\n      switch (value) {\n        case \"cart\":\n          window.location.assign('http://jchermann.com/checkout')\n          break;\n        case \"continue\":\n          window.location.assign('http://jchermann.com/busca')\n          break;\n        default:\n          return true\n      }\n      \n    })\n  }\n\n  const onAddToCart = async() => {\n    if(!item.id) {\n      swal({ icon: 'info', text: 'Escolha um tamanho'});\n      return;\n    }\n\n    try {\n      document.body.classList.add('loading');\n      const updatedOrderForm = await vtexjs.checkout.addToCart([item], null).then(orderForm => orderForm)\n\n      if(skuService.Inicial) {\n        const currentItem = updatedOrderForm.items.filter(i => i.id == item.id).slice(-1)[0];\n        // const currentItem = updatedOrderForm.items.slice(-1)[0];\n        const itemOfering = currentItem.offerings.filter(o => o.type === 'Inicial');\n        \n        // currentItemIndex = updatedOrderForm.items.length - 1;\n        currentItemIndex = updatedOrderForm.items.findIndex(i => i.uniqueId == currentItem.uniqueId);\n        \n        const offeringId = itemOfering[0].id\n        const attachmentData = {...skuService}\n        await vtexjs.checkout.addOffering(offeringId, currentItemIndex) \n\n        const attachment = await vtexjs.checkout\n          .addBundleItemAttachment(currentItemIndex, offeringId, \"Iniciais\", attachmentData)\n  \n        const currentAddedItemError = attachment.messages.filter(m => m.fields.skuName === currentItem.skuName)\n\n        if(currentAddedItemError.length) {\n          vtexjs.checkout.removeItems([{ index: currentItemIndex, quantity: 0 }], null);\n          swal({ icon: 'error', text: currentAddedItemError[0].text });\n        } else {\n          added()\n        }\n        return\n      }\n\n      added()\n\n    } catch(err) {\n      const text = \"Erro ao personalizar\" \n      vtexjs.checkout.removeItems([{ index: currentItemIndex, quantity: 0 }], null);\n      swal({ icon: 'error', text: 'Erro ao customizar o produto. Tente novamente.'});\n    } finally {\n      document.body.classList.remove('loading');\n    }\n  }\n\n  const init = () => {\n    sku.createSkuSelectionComponent()\n    input.init()\n    addToCartButton.addEventListener('click', onAddToCart);\n  }\n  \n  return {\n    init\n  }\n}\n\n\nconst a = customProduct()\n\na.init()\n\n\n//# sourceURL=webpack:///./src/assets/js/custom-product/custom-product.js?")},"./src/assets/js/custom-product/sku-attachment/index.js":function srcAssetsJsCustomProductSkuAttachmentIndexJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\nconst skuAttachmentInput = () => {\n  const wrapper = document.getElementById('sku-service')\n  const attInput = document.createElement('input')\n  const span = document.createElement('span')\n\n  span.innerHTML = '+ R$20,00'\n\n  const onInitialChange = ({ target }) => {\n    const initial = new CustomEvent('initalchange', { detail: target.value })\n    window.dispatchEvent(initial)\n  }\n\n  const init = () => {\n    wrapper.appendChild(attInput)\n    wrapper.appendChild(span)\n\n    attInput.setAttribute('placeholder', 'Adicione suas inicias')\n    attInput.setAttribute('maxlength', '2')\n    attInput.addEventListener('keyup', onInitialChange)\n    \n  }\n\n  return {\n    init\n  }\n}\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (skuAttachmentInput);\n\n//# sourceURL=webpack:///./src/assets/js/custom-product/sku-attachment/index.js?")},"./src/assets/js/custom-product/sku-selection/index.js":function srcAssetsJsCustomProductSkuSelectionIndexJs(module,__webpack_exports__,__webpack_require__){eval("__webpack_require__.r(__webpack_exports__);\nconst skuSelection = () => {\n  const fetchCurrentProduct = () => vtexjs.catalog.getCurrentProductWithVariations()\n  const skuSelectionWrapper = document.getElementById('sku-selection')\n  \n  const onSkuSelect = ({ target }) => {\n    const onSkuChange = new CustomEvent(\n      'skuchange',\n       { detail: target.dataset.sku } \n    )\n\n    const previousSelected = document.querySelector('.sku-selection-button.selected')\n    previousSelected && previousSelected.classList.remove('selected')\n    target.classList.toggle('selected')\n    \n    window.dispatchEvent(onSkuChange)\n  }\n\n  const skuSelectionButton = ({ sku, skuname, available }) => {\n    const button = document.createElement('button')\n\n    button.className = 'sku-selection-button'\n    button.innerHTML = skuname\n    button.setAttribute('data-sku', sku)\n    button.addEventListener('click', onSkuSelect)\n\n    if(!available){\n      button.setAttribute('disabled', 'disabled')\n    }\n\n    return button\n  }\n\n  const createSkuSelectionComponent = async() => {\n    const fragment = document.createDocumentFragment()\n    const product = await fetchCurrentProduct()\n    \n    product.skus.map(sku => \n      fragment.append(skuSelectionButton(sku))\n    )\n\n    skuSelectionWrapper.appendChild(fragment)\n  }\n\n  return {\n    createSkuSelectionComponent\n  }\n}\n\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (skuSelection);\n\n//# sourceURL=webpack:///./src/assets/js/custom-product/sku-selection/index.js?")},1:function _(module,exports,__webpack_require__){eval('module.exports = __webpack_require__(/*! /Users/diegochaves/Projects/vtex-speed-webpack/src/assets/js/custom-product/custom-product.js */"./src/assets/js/custom-product/custom-product.js");\n\n\n//# sourceURL=webpack:///multi_./src/assets/js/custom-product/custom-product.js?')}});